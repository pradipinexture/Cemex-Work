<#assign journalArticleId = .vars['reserved-article-id'].data>

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

<link href ="/documents/20152/86673076/bootstrap.min.css" rel="stylesheet" />
  
<script type="text/javascript" src="https://maps.google.com/maps/api/js?key=AIzaSyBYQKXwHhI8LwTxfxK8PQ3nFZAQc4nsjqU&sensor=false"></script>

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<style>
 html{position: relative; min-height: 100%;}
  body{margin-bottom: 60px;}
  .navbar-default{background-color:#ffffff!important;}
  .navbar-logo{width:100px; height:auto;}
  .embed-responsive-100x400px{padding-bottom: 400px;}
  .btnContainer{padding-top:20px; padding-bottom:20px;}
  .btnCxBl{background-color:#1697f3; color:#ffffff; border-radius:25px;}
  .btnCxBl:hover{color:#1697f3; background-color:#eeeeee;}
  .btnCxWt{border:thin solid #1697f3; border-radius:25px; color:#1697f3;}
  .btnCxWt:hover{color:#1697f3; background-color:#eeeeee; border-color:#eeeeee;}
  .containerText{padding-left:10px; padding-right:10px;}
  .footer{width:100%; height: 60px; position: absolute; bottom: 0; background-color:#023185!important;}
  .footer-logo{width:100px; height:auto; padding-top:20px; padding-bottom:10px; margin-left:auto; margin-right:auto; display:block;}

   .signed-in .app-root.cx-guest-view [class*="col-"], .signed-in .app-root.cx-guest-view [class^="col-"], .signed-in .app-root [class*="col-"], .signed-in .app-root [class^="col-"]
   {
   padding-left: 15px;
   }
   

   .app-root.cx-guest-view [class*="col-"], .app-root.cx-guest-view [class^="col-"], .app-root [class*="col-"], .app-root [class^="col-"]
   {
   padding-right: 15px;
   }
   
   div.phone{
   font-size:16px;
   font-weight:500;
   color:#001B3A;
   }
  
  .header-title, .header-back-to{
   display:none;
   }

   
   .fa-map-marker, .fa-phone {
     color: #0074D4;
   }

   .fa-map-marker:before {
    content: "\f041";
   }
   #calculator {
    display: none;
   }
   #bannerPlaceholder{min-height:20px!important; width:100%;}
</style>


<#assign journalService = serviceLocator.findService("com.liferay.journal.service.JournalArticleService") />

<#assign article = journalService.getArticle(20152,"86677322")/>

<#assign docXml = saxReaderUtil.read(article.getContentByLocale(themeDisplay.getLanguageId())) />

<#assign contactInformation  = docXml.valueOf("//dynamic-element[@name='ContactInformation']/dynamic-content/text()")!"" />

<#assign Description  = docXml.valueOf("//dynamic-element[@name='Description']/dynamic-content/text()")!"" />

<#assign OpeningTimes  = docXml.valueOf("//dynamic-element[@name='OpeningTimes']/dynamic-content/text()")!"" />

<#assign PhoneDetails  = docXml.valueOf("//dynamic-element[@name='PhoneDetails']/dynamic-content/text()")!"" />

<#assign closeLabel  = docXml.valueOf("//dynamic-element[@name='closeLabel']/dynamic-content/text()")!"" />

<#assign mondayLabel  = docXml.valueOf("//dynamic-element[@name='mondayLabel']/dynamic-content/text()")!"" />

<#assign tuesdayLabel  = docXml.valueOf("//dynamic-element[@name='tuesdayLabel']/dynamic-content/text()")!"" />

<#assign wednesdayLabel  = docXml.valueOf("//dynamic-element[@name='wednesdayLabel']/dynamic-content/text()")!"" />

<#assign thursdayLabel  = docXml.valueOf("//dynamic-element[@name='thursdayLabel']/dynamic-content/text()")!"" />

<#assign fridayLabel  = docXml.valueOf("//dynamic-element[@name='fridayLabel']/dynamic-content/text()")!"" />

<#assign saturdayLabel  = docXml.valueOf("//dynamic-element[@name='saturdayLabel']/dynamic-content/text()")!"" />

<#assign sundayLabel  = docXml.valueOf("//dynamic-element[@name='sundayLabel']/dynamic-content/text()")!"" />



<#if (GeolocationData.getData() != "")>
<#assign geolocationJSONObject = jsonFactoryUtil.createJSONObject(GeolocationData.getData())>
<script>
console.log(${geolocationJSONObject});
</script>

<#assign latitude = geolocationJSONObject.getDouble("latitude")>
<#assign longitude = geolocationJSONObject.getDouble("longitude")>
<input type="hidden" id="latitudeInput" name="latitude" value="${latitude}">
<input type="hidden" id="longitudeInput" name="longitude" value="${longitude}">
</#if>

<div class="container">
     <#if LocationTitle?has_content && LocationTitle.getData() != "">
      <div class="row" style="margin-bottom:10px; padding-top:70px;">
        <div class="col-xs-12">
          <div class="containerText">
          <h1>${LocationTitle.getData()}</h1>
          </div>
        </div>
      </div>
      </#if>  
      <div class="row" style="margin-top:10px; margin-bottom:10px;">
        <div class="col-sm-4">
          <div class="containerText">
            <p style="font-weight:600; font-size:16px;">

               <#if Address.getData()?has_content>${Address.getData()}</#if>
               <#if Address2.getData()?has_content>, ${Address2.getData()}</#if>
               <#if TownCity.getData()?has_content>, ${TownCity.getData()}</#if>
               <#if State ?? && State.getData()?has_content >, ${State.getData()},</#if>
               <br>
               <#if Region ?? && Region.getData()?has_content> ${Region.getData()}</#if>
               <#if Country.getData()?has_content>, ${Country.getData()}</#if>
               <#if Postcode.getData()?has_content>, ${Postcode.getData()}</#if>
            </p>

            <#if ProductCard?has_content && ProductCard.getSiblings()?has_content && ProductCard.getSiblings()?size != 0>
            <hr />
                <p style="font-size:16px; font-weight:600;">Available Products</p>
                <div class="row">
                    <#list ProductCard.getSiblings() as product>
                        <div class="col-xs-4">
                            <#if product.Name?has_content && product.Name.getData()?has_content && product.Link?has_content && product.Link.getData()?has_content>
                                <a href="${product.Link.getData()}">${product.Name.getData()}</a>
                            <#elseif product.Name?has_content && product.Name.getData()?has_content>
                                <span>${product.Name.getData()}</span>
                            </#if>
                        </div>
                    </#list>
                </div>
            </#if>

            <hr />
           
           <#if PhoneNumber?has_content && PhoneNumber.getData() != "">
            <h3 style="font-size:16px; font-weight:600;">Phone Details</h3>
            <div class="row">
              <div class="col-sm-6">
                ${(PhoneDetails?has_content)?then(PhoneDetails, 'Main Phone Details')}:     
              </div>
              <div class="col-sm-6">
                 <a href="tel:${PhoneNumber.getData()}">${PhoneNumber.getData()}</a>
              </div>
            </div>

             <#if ContactDetail?has_content && ContactDetail.getSiblings()?has_content  && ContactDetail.getSiblings()?size != 0>
                    <#list ContactDetail.getSiblings() as contact>
                      <div class="row">
                          <div class="col-sm-6">
                            
                            <#if contact.ContactName?has_content && contact.ContactName.getData()?has_content && contact.ContactName.getData() != "-"> ${contact.ContactName.getData()}: 
                            <#else>
                               ${(PhoneDetails?has_content)?then(PhoneDetails, 'Phone Details')}: 
                            </#if>

                          </div>
                          <div class="col-sm-6">
                            <#if contact.PhoneNumber1?has_content && contact.PhoneNumber1.getData()?has_content> 
                           <a href="tel:${contact.PhoneNumber1.getData()}">${contact.PhoneNumber1.getData()}</a>
                            </#if> 
                          </div>  
                        </div>    
                    </#list>       
                                
            </#if> 
           </#if>

            <hr />
            <p style="font-size:16px; font-weight:600;">${(OpeningTimes?has_content)?then(OpeningTimes, 'Opening Times')}</p>
            <#assign daysOfWeek = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"]>

            <#list daysOfWeek as day>
                <#assign separator = day + "_Separator">
                <#assign timingSeparator = .vars[separator]!{}>
                <#assign dayTimingSeparator = timingSeparator["TimingSeparator" + day]!{}>
                <#assign open = (dayTimingSeparator[day + "Open"].getData())!"">
                <#assign close = (dayTimingSeparator[day + "Close"].getData())!"">
                <#assign hours = (open?has_content && close?has_content)?then(open + " - " + close, "Closed")>
                
                <div class="row">
                    <div class="col-xs-6">
                        ${day}:
                    </div>
                    <div class="col-xs-6">
                        ${hours}
                    </div>
                </div>
            </#list>
          </div>
        </div>



        <div class="col-sm-8">
          <div class="containerText">
            <div class="embed-responsive embed-responsive-100x400px">

            <iframe style="min-height:400px; width:100%; border-radius:25px 0 25px 0;"
                           referrerpolicy="no-referrer-when-downgrade"
                           src=""
                           allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade">
                        </iframe>     
            </div>
          </div>
        </div>
      </div>

      <div class="row" style="margin-top:30px; margin-bottom:30px;">
        <div class="containerText">
            <div class="col-sm-4">
              <div class="btnContainer">
                <a class="btn btnCxWt" style="width:100%;" href="#"><i class="fas fa-directions"></i> Get Directions</a>
              </div>
            </div>
            <div class="col-sm-4">
                <div class="btnContainer">
                  <a class="btn btnCxBl" style="width:100%;" id="request-a-quote" href="#"><i class="fas fa-file"></i> Get A Quote</a>
                </div>
            </div>
            <div class="col-sm-4">
              <div class="btnContainer">
                <a class="btn btnCxWt" style="width:100%;" id="calculator" href="#"><i class="fas fa-calculator"></i></a>
              </div>
            </div>
        </div>
      </div>
      
      <div class=”row”>
        <div class=”col-sm-12”>
           <div id="placeholder-kyu5"></div>
        </div>
    </div>

      <div class="containerText">
         <hr />
      </div>

      <#if ContactDetail?has_content && ContactDetail.getSiblings()?has_content && ContactDetail.getSiblings()?size != 0>
        <#list ContactDetail.getSiblings() as contact>
          <#-- Check for all required fields. Exit loop if any field is null or equals '-' -->
          <#if !(contact.JobPosition.getData()?has_content && 
                 contact.JobPosition.getData() != "-" &&
                 contact.ContactName.getData()?has_content && 
                 contact.ContactName.getData() != "-" &&
                 contact.EmailAddress.getData()?has_content &&
                 contact.EmailAddress.getData() != "-" &&
                 contact.PhoneNumber1.getData()?has_content &&
                 contact.PhoneNumber1.getData() != "-")>
            <#break> <!-- Exit the loop if any field is null or equals '-' -->
          </#if>

          <#-- If all fields are valid, render the container -->
          <div style="margin-top:10px; margin-bottom:30px;">
            <div class="containerText">
              <p style="font-size:16px; font-weight:600;">
                ${(contactInformation?has_content)?then(contactInformation, 'Contact Information')}
              </p>
              <div class="row">
                <#list ContactDetail.getSiblings() as validContact>
                  <#if validContact.JobPosition.getData()?has_content &&
                       validContact.JobPosition.getData() != "-" &&
                       validContact.ContactName.getData()?has_content &&
                       validContact.ContactName.getData() != "-" &&
                       validContact.EmailAddress.getData()?has_content &&
                       validContact.EmailAddress.getData() != "-" &&
                       validContact.PhoneNumber1.getData()?has_content &&
                       validContact.PhoneNumber1.getData() != "-">
                    <div class="col-sm-4">
                      <p>${validContact.JobPosition.getData()}<br>
                      ${validContact.ContactName.getData()}<br>
                      ${validContact.EmailAddress.getData()}<br>
                      ${validContact.PhoneNumber1.getData()}</p>
                    </div>
                  </#if>
                </#list>
              </div>
            </div>
          </div>

          <#-- Exit the loop after showing the container -->
          <#break>
        </#list>
      </#if>


       <div class="row" style="margin-top:30px; margin-bottom:30px;">
        <div class="col-sm-6">
          <div class="containerText">
             <#if RichText?has_content && RichText.getData()?has_content && RichText.getData() != "">
                   <p style="font-size: 16px; font-weight: 600">
                       About ${LocationTitle.getData()}
                       <#if RichText.getData()?has_content>
                           <p> ${RichText.getData()} </p>
                        </#if>
                   </p>
             </#if>  
             <div class="row" style="margin-top:20px;">
                <#if FileCard?has_content && FileCard.getSiblings()?has_content && FileCard.getSiblings()?size != 0>  
                    <#list FileCard.getSiblings() as fileData>      
                        <#if fileData.LocationPriceList?? && fileData.LocationPriceList.getData()?has_content >                
                          <div class="col-sm-6">
                           <a  href="${fileData.LocationPriceList.getData()}" class="btn btnCxWt" style="width:100%;" style="width: 100%" download>
                                   ${fileData.PriceName.getData()}
                               </a>
                          </div>
                        </#if>    
                    </#list>  
                </#if>
            </div>
          </div>
        </div>

        <div class="col-sm-6">
          <div class="containerText">
           <#if LocationImage?? && LocationImage.getData() != "">
                <img src="${LocationImage.getData()}" style="border-radius:25px 0 25px 0; width: 100%; height: 100%;"/>
            </#if>
          </div>
        </div>
      </div>    
</div>


<script
   src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
   integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
   crossorigin="anonymous"
   ></script>
   
<script>
    
var coutryLanguageId = null;

var countryGroupId = themeDisplay.getScopeGroupId();
var countryCompanyId = themeDisplay.getCompanyId();


var requestQuotePage = "";
 
 
   // List of eu countries with data
var listOfEUCountries = [
  { name: 'Germany', languageId: 'de_DE', wcmFolderId: 60265754, documentMediaFolderId: '60265900',layoutUUID: "a19c4060-07be-dcb9-5b60-03f5c795e4cc",code: "DE",JobPosition : 364176},
  { name: 'United Kingdom', languageId: 'en_GB', wcmFolderId: 360229, documentMediaFolderId: '60329921',layoutUUID: "",code: "GB",planttype :"Plant Types",JobPosition:'21222222222', requestQuotePage: '/web/cemex-uk/request-a-quote'},
  { name: 'Spain', languageId: 'es_ES', wcmFolderId: 360229, documentMediaFolderId: '60315089',layoutUUID: "d9fb9a9f-999c-6401-ea51-ed8f2a8aa985",code: "ES"},
  { name: 'Czech Republic', languageId: 'cs_CZ', wcmFolderId: 60326347, documentMediaFolderId: '60326349',layoutUUID: "f8dc0ec0-0bac-3acc-4461-2ac9361a59f0",code: "CZ"},
  { name: 'Poland', languageId: 'pl_PL', wcmFolderId: 60330119, documentMediaFolderId: '60330121',layoutUUID: "d9113e4a-0025-2bfa-d448-c2ff1fa51ae6",code: "PL"},
  { name: 'France', languageId: 'fr_FR', wcmFolderId: 60353105, documentMediaFolderId: '60353107',layoutUUID: "1dfadceb-64b8-cc19-e32e-c714ba361ad8",code: "FR"},
  { name: 'Croatia', languageId: 'hr_HR', wcmFolderId: 60354285, documentMediaFolderId: '60354287',layoutUUID: "b19d49ae-6bae-1163-5e9b-308af376dc71",code: "HR" ,planttype :"Plan Demo"}
];
 

// Get current coutry data and init values
var currentCountry = listOfEUCountries.find(country => country.languageId === themeDisplay.getLanguageId());
 
 
if(currentCountry){
  coutryLanguageId = currentCountry.languageId;
  requestQuotePage = currentCountry.requestQuotePage || "#";
} else {
  console.error("Error while fetching current coutry from array");
}
 
 
$("#request-a-quote").attr("href",requestQuotePage)

if($("h1").text().toLowerCase().includes("concrete")) {
    $('#calculator')
      .attr('href', 'https://www.cemex.co.uk/readymix-concrete-calculator')
      .css('display', 'inline-block')
      .html('<i class="fas fa-calculator"></i> Concrete Calculator');  
}

     
   $("#redirect-url").on("keyup", function(e) {
      e.preventDefault();
      if($("#redirect-url").val()) {
         $("#redirect-error").text("")
      } else {
         $("#redirect-error").text("Please provide redirection url.")
      }
   
   })
   $("#save-url").on("click", function(e) {
      var userRedirectURL = $("#redirect-url").val();
      var pageArticleId = "${journalArticleId}";
      if(!userRedirectURL) {
         $("#redirect-error").text("Please provide redirection url.")
         return;
      }
   
      if(pageArticleId ) {
         updateRedirectionURL(pageArticleId, userRedirectURL)
           .then(function() {
             console.log('Redirection URL updated successfully.');
             window.location.href = document.referrer;
           })
           .catch(function(error) {
             console.error('Error occurred while updating redirection URL:', error);
           });
      } else {
         console.log("Article is not present")
      }
   })
   
   function updateRedirectionURL(locationId, redirectURL) {
           return new Promise(function(resolve, reject) {
               Liferay.Service('/journal.journalarticle/get-article', {
                   groupId: themeDisplay.getScopeGroupId(),
                   articleId: locationId
               }, function (webContent) {
                   try {
                       var updatedXMLString = xmlOperations(webContent.content, redirectURL);
                       webContent.content = updatedXMLString;
   
                       updateLocationIsClosedField(webContent, function() {
                           resolve();
                       });
                  } catch (error) {
                       reject(error); // Reject the promise if an error occurs
                   }
               });
           });
       }   
   
       function xmlOperations(webContentData, redirectURL) {
           var parser = new DOMParser();
               var xmlDoc = parser.parseFromString(webContentData, 'application/xml');
               
               const dynamicElement = xmlDoc.createElement('dynamic-element');

               dynamicElement.setAttribute('name', "RedirectionURL");
               dynamicElement.setAttribute('type', "text");
               dynamicElement.setAttribute('index-type', 'keyword');
               dynamicElement.setAttribute('instance-id', "isClosed_instance");

               const dynamicContent = xmlDoc.createElement('dynamic-content');
               dynamicContent.setAttribute('language-id', "" + themeDisplay.getLanguageId() + "");

               const cdata = xmlDoc.createCDATASection(redirectURL);
               dynamicContent.appendChild(cdata);

               dynamicElement.appendChild(dynamicContent);
           
               xmlDoc.documentElement.appendChild(dynamicElement);

               var serializer = new XMLSerializer();
               var updatedXmlString = serializer.serializeToString(xmlDoc);
               console.log(updatedXmlString);
               return updatedXmlString;
       }
   
   
       function updateLocationIsClosedField(finalWCM, callback) {
           Liferay.Service('/journal.journalarticle/update-article', finalWCM,
               function(obj) {
                   console.log("Updated Object is : ");
                   console.log(obj);
                   if (callback) {
                       callback();
                   }
               }
           );
       }
   
function initMap() {
   $(document).ready(function () {
     const googleMapKey = "AIzaSyBYQKXwHhI8LwTxfxK8PQ3nFZAQc4nsjqU";
     var latitude = parseFloat(document.getElementById("latitudeInput").value);
     var longitude = parseFloat(document.getElementById("longitudeInput").value);
     var iframe = document.getElementsByTagName("iframe")[0];
   
      if (iframe) {
       var locationName = "";

       getReverseGeocodingData(latitude, longitude, function (placeQuery) {
         locationName = placeQuery;
         
         // Set the iframe source (if needed for other purposes)
         var iframeSrc =
           "https://www.google.com/maps/embed/v1/place?key=" +
           googleMapKey +
           "&q=" +
           encodeURIComponent(locationName);
         iframe.src = iframeSrc;

         // Generate the directions URL
         var directionsUrl = 
           "https://www.google.com/maps/dir/?api=1&key=" + googleMapKey +
           "&destination=" + encodeURIComponent(locationName);

         // Set the href of the 'Get Directions' button
         var directionsButton = document.querySelector(".btnCxWt[href='#']");
         if (directionsButton) {
           directionsButton.href = directionsUrl;
         }
       });
     }
   });
}  
   
   function getReverseGeocodingData(lat, lng, callback) {
     var latlng = new google.maps.LatLng(lat, lng);
     var geocoder = new google.maps.Geocoder();
   
     geocoder.geocode({ latLng: latlng }, function (results, status) {
       if (status !== google.maps.GeocoderStatus.OK) {
         console.log(status);
         return;
       }
       if (status == google.maps.GeocoderStatus.OK) {
         var placeQuery = results[0].formatted_address;
         callback(placeQuery);
       }
     });
   }

// Ensure the map initializes after the page has fully loaded
google.maps.event.addDomListener(window, 'load', initMap);
   
</script>

<script>
    $(document).ready(function () {
    if (themeDisplay.getPathThemeRoot() === '/o/cemex-uk-theme-v2') {
        var pElements = document.querySelectorAll('p');
        pElements.forEach(function(element) {
            element.style.paddingBottom = '0';
        });
        

        var btnContainers = document.getElementsByClassName('btnContainer');
   for (var i = 0; i < btnContainers.length; i++) {
       var btnContainer = btnContainers[i];
       btnContainer.style.paddingRight = '20px';
   }
    }
});
document.addEventListener('click', function (e) { 
    e = e || window.event;
    var target = e.target || e.srcElement;

    if (target.hasAttribute('data-toggle') && target.getAttribute('data-toggle') == 'popup') {
        if (target.hasAttribute('data-target')) {
            var m_ID = target.getAttribute('data-target');
            document.getElementById(m_ID).classList.add('open');
            e.preventDefault();
        }
    }

    // Close modal window with 'data-dismiss' attribute or when the backdrop is clicked
    if ((target.hasAttribute('data-dismiss') && target.getAttribute('data-dismiss') == 'popup') || target.classList.contains('popup')) {
        const popupDiv = document.getElementsByClassName('popup');
        if(popupDiv && popupDiv?.length > 0){
            for (let item of popupDiv) {
                if(item?.classList?.contains('open')){
                    item?.classList?.remove('open');
                }
            }
        }
        e.preventDefault();
    }
}, false);
</script>